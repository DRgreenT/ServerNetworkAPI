<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Network Scanner</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #171717;
      color: lightgray;
      margin: 0;
      padding: 2em;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      background-color: #1e1e1e;
      color: lightgray;
      font-size: 0.9em;
    }

    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #333;
    }

    th {
      background-color: #222;
      font-weight: bold;
    }

    .online {
      background-color: green;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
    }

    .offline {
      background-color: red;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
    }

    details summary {
      cursor: pointer;
      color: orange;
      font-weight: bold;
    }

    .port-entry {
      margin-left: 10px;
      font-size: 0.85em;
      color: #bbb;
    }
  </style>
</head>
<body>
  <h1>NetworkDevices</h1>
  <div id="results"> loading...</div>

  <script>
    async function fetchDevices() {
      try {
        const response = await fetch("http://192.168.178.10:5050/network");
        if (!response.ok) throw new Error("Error...API or IP not found");

        const devices = await response.json();
        render(devices);
      } catch (err) {
        document.getElementById("results").innerHTML = `<p>Error: ${err}</p>`;
      }
    }

    function render(devices) {
      if (devices.length === 0) {
        document.getElementById("results").innerHTML = "<p>No devices found</p>";
        return;
      }

      const rows = devices.map(d => `
        <tr>
          <td><span class="${d.isOnline ? 'online' : 'offline'}"></span></td>
          <td>${d.ip}</td>
          <td>${d.hostname}</td>
          <td>${d.os}</td>
          <td>
            ${d.ports && d.ports.length > 0 ? `
              <details>
                <summary>Ports (${d.ports.length})</summary>
                ${d.ports.map(p => `<div class="port-entry">${p.port}/${p.protocolType} (${p.service})</div>`).join('')}
              </details>` : "<i>-</i>"}
          </td>
        </tr>
      `).join("");

      const html = `
        <table>
          <thead>
            <tr>
              <th>Status</th>
              <th>IP</th>
              <th>Hostname</th>
              <th>OS</th>
              <th>Ports</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;

      document.getElementById("results").innerHTML = html;
    }

    fetchDevices();
    setInterval(fetchDevices, 15000);
  </script>
</body>
</html>
